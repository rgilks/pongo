---
alwaysApply: true
---

## Principles

- Keep changes small and test each step.
- Refactor for clarity: simple, elegant, maintainable.
- Improve tests, docs, and diagrams continuously.
- Remove dead or commented-out code.
- Use whitespace for readability.
- Keep functions < 20 lines; files < 200 lines.

## Technology preferences

- Prefer WebGPU via `wgpu` v24.0; avoid WebGL2 fallbacks.
- Prefer Node for servers/tooling; never use Python.

## Logging

- Ensure logs are sufficient for debugging and monitoring.

## Testing

- Maintain a `TEST-PLAN.md` document with a set of manual tests that you will run by automating the web browser this is in place of puppeteer or playwright tests.

## Pre-commit and push

**Required workflow for each iteration:**

1. **Fix linting errors**

   - Run `cargo fmt` to format code
   - Run `cargo clippy --workspace -- -D warnings` and fix all warnings/errors

2. **Run unit tests**

   - Run `cargo test --workspace` and ensure all tests pass
   - Fix any failing tests

3. **Local testing (TEST-PLAN.md)**

   - Follow `TEST-PLAN.md` for manual/local testing
   - Test relevant endpoints and functionality locally if possible

4. **Deploy to Cloudflare**

   - Run `npx wrangler deploy` to deploy to production
   - Verify deployment succeeds

5. **Deployed testing (TEST-PLAN.md)**

   - Test deployed endpoints according to `TEST-PLAN.md`
   - Verify all M2 endpoints work: `/`, `/create`, `/join/:code`
   - Test WebSocket connections if applicable

6. **Check Cloudflare logs**

   - Run `npm run logs:check` to automatically check logs for errors (recommended)
   - Or manually run `npm run logs` to tail logs in real-time
   - Check for errors, warnings, or unexpected behavior in Workers
   - Check Durable Object logs for game simulation issues
   - Verify WebSocket connections are being handled correctly
   - Look for any runtime errors or exceptions
   - Note: The automated check runs for 10 seconds and reports any errors found

7. **Documentation updates**

   - Update `README.md`, `TEST-PLAN.md` and `SPEC.md` if needed
   - Document any new features or changes

8. **Commit and push**
   - Only commit and push after all above steps succeed
   - Use descriptive commit messages
